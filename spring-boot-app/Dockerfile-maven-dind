# Start from Docker-in-Docker (dind) image
FROM docker:27-dind

# Install Maven + Java (using Alpine packages)
RUN apk add --no-cache openjdk17 maven git bash

# Set environment variables
ENV JAVA_HOME=/usr/lib/jvm/java-17-openjdk
ENV PATH=$PATH:$JAVA_HOME/bin

# Verify installation
RUN java -version && mvn -version && docker --version

# Default work directory
WORKDIR /workspace

# Start Docker daemon by default
CMD ["dockerd-entrypoint.sh"]